# day4 (xml, http 실습)

노트북 램 교체와 관련해 시간을 많이 허비했다. (램 슬롯이 고장났는지, 새 램을 샀는데도 인식을 못한다.) 그래서 오늘은 공부를 늦게 시작할 수밖에 없었다.



### xml 통신

XMLHttpRequest 객체를 통해 비동기 통신을 처리한다.

이벤트 핸들러를 통해 간접적으로 데이터를 주고받기 때문에, 직접적으로 데이터를 어떻게 처리할지 걱정하지 않아도 된다. XML에 append 형태로 원하는 데이터를 마음껏 구겨넣고 서버와 통신할 수 있다는 장점도 있다.

일종의 프레임워크처럼 생각해도 좋지만, 동적이고 혁신적인 웹을 만들려면 API처럼 활용할 수 있는 유연성도 갖추고 있어야겠다.

- XML 통신은 헤더에 직접 쏘기 때문에 form으로 들어가지 않는다. 따라서 flask 에서 뽑아서 쓰려면 request.headrs['key'] 를 이용하면 된다. 이것도 모르고 request.form 으로 왜 안 뽑히나 몇시간을 끙끙대다 겨우 해결했다.
- 웹브라우저 개발자 모드에서 헤더는 알파벳 순서대로 나열된다. XML로 보낸 값이 맨 뒤에 있거나 하지는 않는다. 이것도 모르고 또 몇시간을 끙끙댔다.
- 헤더에는 ASCII 문자열밖에 담을 수 없다. 그래서 한글을 보낼 때 인코딩하지 않으면 오류가 발생한다. 이렇게 인코딩한 문자열은 파이썬에서 꺼내서 쓸 때 다시 디코딩해줘야 한다. 마찬가지로, XML에 숫자를 담아도 헤더로 보내질 땐 문자열 형태로 바뀐다.



### http 실습

- Python flask에서 HTML로 데이터를 쏴주는 가장 좋은 방법은 json 형태를 활용하는 것이다. 이후 {{ data.username }} 과 같은 형태로 HTML에서 받아서 사용할 수 있다.
- {{ content }} 꼴은 flask에서 닥치고 무식하게 파싱해버린다(제대로 이해한 게 맞는지 모르겠다). 개발자 모드를 켜 보면, 주석이든 HTML 태그 속성값 안에 들어있는 다 씹어버리고 작동하는 걸 볼 수 있다. 즉, C언어의 #define 과 비슷한 개념이다. 그래서 '변수 이름'이나 'HTML 문서 내용 전체' 같은 괴상한 걸 넣어도 어떻게든 작동한다.
  + Javascript의 innerHTML도 비슷한 방식으로 작동한다. 그래서 js에서 미리 HTML 문서를 필요한 만큼 생성한 다음, 변수 넘기듯이 보내줄 수 있다. 표 같은 반복되는 형태를 만들 때 특히 좋다. (새 값이 추가될 때마다 표가 자동으로 늘어나는 멋있는 기능도 만들 수 있다.)

- Javascript에서 import를 사용하는 건 꽤나 어려운 일이다. 웬만하면 HTML < script > 태그 안에서 처리하는 게 좋은데, 변수스코프가 상당히 골치아프다. 검색해봐도 도움말도 잘 안 나오고, 애초에 변수스코프가 꼬일 걱정이 없도록 깔끔하게 코드를 짜는 게 답인 것 같다.
- flask에서 return 값이 없으면 에러가 난다. 별다른 응답을 보내주고 싶지 않을때는, flask.Response(status=200) 해주면 된다.

- js에서 바로 DB에 접근했다간 큰일나는 수가 있다.
  + 내 게임은 사용자가 클라이언트를 뜯어서 highscore에 비정상적으로 큰 값을 넣어서 보내면 최고점수 핵을 쓸 수 있다. 하지만 이건 '보내는 것' 이다. 생 자바스크립트에는 DB를 수정할 수 있는 권한을 넣을 수도 없고, 넣어서도 안 된다.
  + DB 접근 권한을 검증하거나, 사용자 로그인 여부를 확인하는 등의 웹 보안에 관한 내용을 공부해야 한다.



### DB와 연결

- primary key 값은 SQL 객체 속성에 딱 하나만 들어가야 한다.
- get() 함수는 아무것도 없으면 None을 반환하기 때문에 다양하게 활용할 수 있다. get_or_404() 함수는 아무것도 없으면 404를 반환한다.
- filter() 함수는 검색결과가 없어도 빈 리스트를 반환하기 때문에 사용에 주의해야 한다.
- SQL 쉽다. 인터프리터 shell로 조작하는 법에 익숙하다면 전혀 어려울 일이 없다.
  + 다양한 필터를 자유자재로 활용하는 방법을 좀 더 공부할 필요가 있겠다.



### Flask 적응 마무리

- 클라이언트(HTML, Javascript), 통신(HTTP, XML), 서버(flask, SQL)가 서로 완벽하게 협업하는 프로젝트를 드디어 만들 수 있게 되었다!!!
- 아직 몇 가지 부족한 점이 느껴진다. flask-SQLAlchemy 도큐먼트를 아직 완벽하게 숙지하지 못했고, axios 활용법도 배우지 못했다. CSS로 미디어쿼리나 bootstrap.css 같은 걸 활용해 프론트엔드를 예쁘게 꾸미는 법도 아직 배우지 못했다. SQL 자료형태를 다루는 것도 아직 미숙하고, 실제 업무에 필요한 Pythong logging 모듈 숙지는 아직 한 발짝도 못 나간 상태다.
  + 몇 가지 작은 목표점을 놓친 부분도 꽤 있다. js로 FormData 검증하는 로직이 왜 작동을 안하는지 아직도 모르겠다.
- 그래도... 이렇게 토이프로젝트 하나를 괜찮은 수준(실사용 가능)으로 마무리짓고 나니 뿌듯함이 느껴진다. 나는 이제 내가 만든 프로그램을 웹의 형태로 배포할 수 있게 되었다. 프론트엔드가 구린 건 협업하면 될 일이다. 일단 기획자로써 이해해야 할 웹의 다양한 속성을 전부 어느정도 알게 되었다는 것에 가치를 두고 싶다.

